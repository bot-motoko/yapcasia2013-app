<!DOCTYPE html>
<html lang="ja" xmlns:og="http://ogp.me/ns#" xmlns:mixi="http://mixi-platform.com/ns#" xmlns:fb="http://www.facebook.com/2008/fbml">
<head>
<meta charset="utf-8" />
<link rel="shortcut icon" href="http://yapcasia.org/2013/static/images/favicon.ico">
<link rel="stylesheet" href="http://yapcasia.org/2013/static/css/style.css">
<link rel="start" href="http://yapcasia.org/2013/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="http://yapcasia.org/2013/atom.xml" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/jquery-ui.min.js"></script>
<!--[if lt IE 9]>
<script src="http://yapcasia.org/2013/static/js/html5shiv.js"></script>
<script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js"></script>
<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
<![endif]-->

<style>
<!--
/* ざっくりスタイル書きます */
    img {
        display: inline-block;
        -webkit-border-radius: 10px;
        -moz-border-radius: 10px;
        border-radius: 10px;
    }
    table {
        display: inline-block;
        -webkit-border-radius: 10px;
        -moz-border-radius: 10px;
        border-radius: 10px;
        border: solid 1px #ddd;
        background-color: #fff;
    }
    caption {
        padding: 5px 5px 5px 10px;
        font-weight: bold;
        font-size: 1.5em;
        border-bottom: 1px solid #ddd;
    }
    td {
        vertical-align:top;
        border-bottom: 1px solid #ddd;
    }
    td.img {
        text-align:center;
        padding: 5px;
        width: 50px;
    }
    td.text {
        padding: 5px 5px 5px 0;
    }
    span.name {
        font-weight: bold;
    }
    span.date {
        display: inline-block;
        width: 100%;
        text-align: right;
        color: #999;
    }
//-->
</style>

</head>

<title>YAPC::Asia Information</title>

<body>
<header>
<div id="logo"><a href="http://yapcasia.org/2013/"><img src="http://yapcasia.org/2013/static/images/logo.png" alt="YAPC::Asia TOKYO 2013" width="100%" /></a></div>
</header>

<div id="main">

<div class="section">
<div class="body">
<table id="content">
    <caption>YAPC::Asia 最新情報</caption>
</table>

<script>
<!--
// ざっくりスクリプト書きます
$(document).ready(function(){
    var since_id = 0;
    var has_ids = {};
    function get_timeline (since_id){
        var v = Math.round( Math.random() * 10000000 );
        var elements = new Array();
        $.getJSON("/2013/api/timeline/?since_id="+since_id+"&v=" + v, function(json){
            json.reverse();
            for( var i = 0; i < json.length; i++){
                // すでに取得していたら飛ばすし、ないなら手持ちidに追加
                if ( json[i].id　in has_ids ){
                    continue;
                }
                has_ids[json[i].id] = 1;

                // 日付変換
                var date = new Date(json[i].created_at);
                var date_str = (date.getMonth()+1) + "月" + date.getDate() + "日 " + date.getHours() + ":" + date.getMinutes();
                console.log(json[i].id);
                console.log("tw: " + json[i].text); 

                // エレメント組み立て
                var html = $("#content").html();
                var el = '<tr class="'+ v +'">';
                el += '<td class="img"><img src="' + json[i].user.profile_image_url + '" class="rounded-img"/></td>';
                el += '<td class="text"><span class="name">' + json[i].user.name + '</span><br />' + json[i].text + '<br /><span class="date">' + date_str + '</span></td>';
                el += '</tr>';

                // 後ろに入れる
                $("caption").after(el);
            }

            // 最初はhighlight animationはしない
            if( since_id != 0 ){
                $("tr."+v).stop().animate({ backgroundColor: "#ffff99"}, 500).animate({ backgroundColor: "#ffffff"}, 500).animate({ backgroundColor: "#ffff99"}, 500).animate({ backgroundColor: "#ffffff"}, 500);
            }

            // １分後に次のデータを取得
            if ( json ){
                since_id = json[0].id_str;
            }
            v = Math.round( Math.random() * 10000000 );
            var nexturl = "/2013/api/timeline/";
            var params = { "since_id" : since_id, "v": v };
            var callee = arguments.callee;
            setTimeout( function() {
                $.getJSON( nexturl, params, callee );
            }, 60000 );
        });
    }
    get_timeline(since_id);
});
//-->
</script>

</div><!--  / .body /  -->
</div><!--  / .section /  -->

</div><!--  / #main /  -->

</body>
</html>
